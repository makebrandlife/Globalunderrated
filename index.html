<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hidden Gems — Live Weather & Currency</title>
<meta name="description" content="Plan trips, view live weather, and convert currency — all in a fast single-page travel planner."/>
<meta name="robots" content="index,follow" />
<link rel="preconnect" href="https://images.unsplash.com" crossorigin>
<style>
  :root{--accent:#2a9d8f;--muted:#6b7280;--card:#fff}
  body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:16px;background:#f6f7fb;color:#0b1220}
  .container{max-width:980px;margin:0 auto}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,.06);display:flex;gap:14px;align-items:center}
  .card-media{width:140px;height:90px;overflow:hidden;border-radius:10px;flex:0 0 140px}
  .card-media img{width:100%;height:100%;object-fit:cover;display:block}
  .card-body h3{margin:0;font-size:1.05rem}
  .muted{color:var(--muted)}
  .btn{background:var(--accent);color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
  .btn.secondary{background:#2b6cb0}
  .controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}

  /* modal */
  .modal{position:fixed;inset:0;background:rgba(2,6,23,0.5);display:none;align-items:center;justify-content:center;padding:20px;z-index:1000}
  .modal.open{display:flex}
  .panel{width:100%;max-width:900px;background:#fff;border-radius:12px;padding:18px;box-shadow:0 20px 50px rgba(2,6,23,.2);max-height:90vh;overflow:auto}
  .row{display:flex;gap:10px}
  .row>div{flex:1}
  label{display:block;font-size:.9rem;color:var(--muted);margin-bottom:6px}
  input[type=date],select,input[type=number],textarea{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e6}
  #miniMap{height:220px;border-radius:8px;margin-top:8px}
  .it-day{background:#f8fafb;padding:10px;border-radius:8px;margin-bottom:8px}
  #weatherBox{margin-top:10px;padding:10px;border-radius:8px;background:#f3f8f7;border:1px solid #e6f1ee}
  .forecast{display:flex;gap:8px;margin-top:8px}
  .forecast .day{background:#fff;padding:8px;border-radius:8px;box-shadow:0 6px 18px rgba(2,6,23,0.03);flex:1;text-align:center}
  .small{font-size:.9rem;color:var(--muted)}
  footer{margin-top:16px;font-size:.85rem;color:var(--muted)}
</style>
</head>
<body>
  <div class="container">
    <h1 style="margin:0 0 12px 0">Hidden Gems — Demo destination</h1>

    <div class="card" id="demoCard">
      <div class="card-media">
        <img id="demoImg"
             src="https://images.unsplash.com/photo-1544551763-46a013bb70d5?auto=format&fit=crop&w=800&q=60"
             srcset="https://images.unsplash.com/photo-1544551763-46a013bb70d5?auto=format&fit=crop&w=400&q=60 400w,
                     https://images.unsplash.com/photo-1544551763-46a013bb70d5?auto=format&fit=crop&w=800&q=60 800w,
                     https://images.unsplash.com/photo-1544551763-46a013bb70d5?auto=format&fit=crop&w=1200&q=60 1200w"
             sizes="(max-width:480px) 120px, 160px"
             alt="Faroe Islands" loading="lazy" width="320" height="240">
      </div>
      <div class="card-body">
        <h3 id="demoTitle">Faroe Islands, Denmark</h3>
        <p id="demoDesc" class="muted" style="margin:.25rem 0">Dramatic cliffs, seabirds and Nordic solitude.</p>
        <div class="controls">
          <button class="btn" id="planBtn" aria-haspopup="dialog" aria-controls="plannerModal">Plan a Trip Here</button>
          <button class="btn secondary" id="saveDemoBtn">Save to Bucket List</button>
          <button id="viewBucketBtn" style="margin-left:auto;background:#111827;color:#fff;border:none;border-radius:8px;padding:8px 12px;cursor:pointer">View My Bucket List</button>
        </div>
      </div>
    </div>

    <footer class="small">Tip: install as a PWA for offline usage. Weather and exchange rates are fetched live when you open the planner.</footer>
  </div>

  <!-- Planner Modal -->
  <div class="modal" id="plannerModal" role="dialog" aria-modal="true" aria-labelledby="plannerTitle">
    <div class="panel modal-panel" role="document" tabindex="0">
      <h2 id="plannerTitle" style="margin-top:0">AI Trip Planner — <span id="plDest">Faroe Islands</span></h2>

      <div class="row" style="margin-bottom:10px">
        <div>
          <label for="startDate">Start date</label>
          <input type="date" id="startDate" />
        </div>
        <div>
          <label for="duration">Duration (days)</label>
          <select id="duration">
            <option value="3">3</option><option value="5" selected>5</option><option value="7">7</option><option value="10">10</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-bottom:10px">
        <div>
          <label for="budgetLevel">Budget</label>
          <select id="budgetLevel"><option value="low">Budget</option><option value="mid" selected>Mid-range</option><option value="luxury">Luxury</option></select>
        </div>
        <div>
          <label for="travelerType">Traveler type</label>
          <select id="travelerType"><option value="solo">Solo</option><option value="couple" selected>Couple</option><option value="family">Family</option></select>
        </div>
      </div>

      <div>
        <label for="notes">Notes</label>
        <textarea id="notes" rows="2" placeholder="e.g. hiking, whales, photography"></textarea>
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="cancelPlanner">Cancel</button>
        <button class="btn" id="generateBtn">Generate Itinerary</button>
      </div>

      <div id="itineraryArea" class="itinerary" aria-live="polite"></div>

      <!-- live weather -->
      <div id="weatherBox" aria-hidden="true"></div>

      <!-- map -->
      <div id="miniMap" aria-hidden="true"></div>

      <!-- Estimated cost & currency -->
      <div style="display:flex;align-items:center;gap:12px;margin-top:12px;flex-wrap:wrap;">
        <div id="costEstimate" class="small">Estimated cost: <strong>USD 0</strong></div>
        <div id="currencyConverter" style="display:flex;gap:8px;align-items:center">
          <label class="small" for="currencySelect">Convert to</label>
          <select id="currencySelect" aria-label="Target currency"></select>
          <div id="convertedCost" class="small"></div>
        </div>
      </div>

      <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
        <button id="downloadPdf" class="btn" style="display:none">Download PDF</button>
        <button id="savePlan" class="btn secondary" style="display:none">Save Plan</button>
        <button id="sharePlan" class="btn" style="display:none">Share</button>
      </div>
    </div>
  </div>

  <!-- Bucket Modal -->
  <div id="bucketModal" class="modal" aria-hidden="true">
    <div class="panel">
      <h3>My Bucket List</h3>
      <div id="bucketListGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px;margin-top:10px"></div>
      <div style="text-align:right;margin-top:10px">
        <button onclick="closeBucketModal()">Close</button>
      </div>
    </div>
  </div>

<script>
/* ---------------------------
   App state
   --------------------------- */
const demo = {
  id: 1,
  name: document.getElementById('demoTitle').textContent,
  desc: document.getElementById('demoDesc').textContent,
  lat: 62.0,
  lng: -6.8
};

const plannerModal = document.getElementById('plannerModal');
const planBtn = document.getElementById('planBtn');
const cancelPlanner = document.getElementById('cancelPlanner');
const generateBtn = document.getElementById('generateBtn');
const itineraryArea = document.getElementById('itineraryArea');
const plDest = document.getElementById('plDest');
const downloadPdfBtn = document.getElementById('downloadPdf');
const savePlanBtn = document.getElementById('savePlan');
const sharePlanBtn = document.getElementById('sharePlan');
const currencySelect = document.getElementById('currencySelect');
const convertedCostEl = document.getElementById('convertedCost');
const costEstimateEl = document.getElementById('costEstimate');
const weatherBox = document.getElementById('weatherBox');

document.getElementById('plDest').textContent = demo.name.split(',')[0];

let miniMap, routeLayer;
let leafletLoaded = false;
let jsPDFLoaded = false;

/* ---------------------------
   Utility: dynamic load
   --------------------------- */
function loadCss(href){ return new Promise((res, rej)=>{ if(document.querySelector(`link[href="${href}"]`)) return res(); const l = document.createElement('link'); l.rel='stylesheet'; l.href = href; l.onload = res; l.onerror = rej; document.head.appendChild(l); }); }
function loadScript(src){ return new Promise((res, rej)=>{ if(document.querySelector(`script[data-src="${src}"]`)) return res(); const s = document.createElement('script'); s.src = src; s.async = false; s.setAttribute('data-src', src); s.onload = res; s.onerror = rej; document.body.appendChild(s); }); }

/* ---------------------------
   Map (Leaflet) - deferred
   --------------------------- */
async function initLeaflet(){
  if(leafletLoaded) return;
  leafletLoaded = true;
  try {
    await loadCss('https://unpkg.com/leaflet@1.9.4/dist/leaflet.css');
    await loadScript('https://unpkg.com/leaflet@1.9.4/dist/leaflet.js');
    miniMap = L.map('miniMap', { zoomControl: false, attributionControl: false }).setView([demo.lat, demo.lng], 9);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(miniMap);
    routeLayer = L.layerGroup().addTo(miniMap);
    document.getElementById('miniMap').setAttribute('aria-hidden', 'false');
  } catch(e){ console.warn('Leaflet failed', e); }
}

/* ---------------------------
   Open modal / focus
   --------------------------- */
let lastActive = null;
planBtn.addEventListener('click', async () => {
  lastActive = document.activeElement;
  plDest.textContent = demo.name.split(',')[0];
  plannerModal.classList.add('open');
  ensureStartDate();
  // defer-load map and weather when modal opens
  initLeaflet().then(()=> miniMap && setTimeout(()=> miniMap.invalidateSize(), 120));
  // fetch currency list & user currency
  await initCurrency();
  // fetch weather
  fetchWeather(demo.lat, demo.lng);
  document.addEventListener('keydown', handleEscape, {capture:true});
});
cancelPlanner.addEventListener('click', closePlanner);
function closePlanner(){
  plannerModal.classList.remove('open');
  itineraryArea.innerHTML = '';
  downloadPdfBtn.style.display = 'none';
  savePlanBtn.style.display = 'none';
  sharePlanBtn.style.display = 'none';
  if(routeLayer && routeLayer.clearLayers) routeLayer.clearLayers();
  document.removeEventListener('keydown', handleEscape, {capture:true});
  lastActive && lastActive.focus && lastActive.focus();
}
function handleEscape(e){ if(e.key === 'Escape') closePlanner(); }
document.getElementById('plannerModal').addEventListener('click', (e)=>{ if(e.target.id === 'plannerModal') closePlanner(); });

function ensureStartDate(){
  const s = document.getElementById('startDate');
  if(!s.value){ const d = new Date(); d.setDate(d.getDate()+7); s.value = d.toISOString().slice(0,10); }
}

/* ---------------------------
   Itinerary generation (local fallback)
   --------------------------- */
function generateItinerary(){
  const start = document.getElementById('startDate').value;
  const days = parseInt(document.getElementById('duration').value, 10);
  const budget = document.getElementById('budgetLevel').value;
  const traveler = document.getElementById('travelerType').value;
  const notes = document.getElementById('notes').value;
  if(!start){ alert('Please choose a start date'); return; }

  // simple keyword-based activities
  const keywords = (demo.desc + ' ' + notes).toLowerCase();
  const activities = [];
  if(keywords.includes('hike') || keywords.includes('cliff')) activities.push('Hike a scenic trail');
  if(keywords.includes('whale')) activities.push('Whale watching tour');
  if(keywords.includes('fjord')) activities.push('Boat cruise of the fjords');
  if(keywords.includes('monastery')) activities.push('Cultural village visit');
  if(activities.length === 0) activities.push('Local highlights and photo spots');

  const plan = [];
  for(let d=0; d<days; d++){
    const date = new Date(start); date.setDate(date.getDate() + d);
    const day = { day: d+1, date: date.toISOString().slice(0,10), items: [] };
    day.items.push({ time: 'Morning', activity: activities[d % activities.length] });
    day.items.push({ time: 'Afternoon', activity: 'Explore local town' });
    if(traveler === 'couple') day.items.push({ time: 'Evening', activity: 'Cozy dinner' });
    else if(traveler === 'solo') day.items.push({ time: 'Evening', activity: 'Photography walk' });
    else day.items.push({ time: 'Evening', activity: 'Family dinner' });
    plan.push(day);
  }

  const base = (budget === 'low')?60:(budget === 'mid')?120:260;
  const estimate = base * days;

  renderPlan(plan, estimate);
  downloadPdfBtn.style.display = 'inline-block';
  savePlanBtn.style.display = 'inline-block';
  sharePlanBtn.style.display = 'inline-block';

  // draw demo route on map
  if(routeLayer && window.L && L.polyline){
    const routeCoords = [];
    for(let i=0;i<6;i++){ const angle=(i/6)*Math.PI*2; const r=0.18; routeCoords.push([demo.lat+Math.sin(angle)*r, demo.lng+Math.cos(angle)*r]); }
    routeLayer.clearLayers();
    L.polyline(routeCoords, { color: '#e76f51' }).addTo(routeLayer);
    routeLayer.addLayer(L.circleMarker([demo.lat, demo.lng], { radius:6, fillColor:'#2a9d8f', color:'#fff', weight:2 }).bindPopup(demo.name));
    try{ miniMap.fitBounds(L.latLngBounds(routeCoords).pad(0.5)); } catch(e){}
  }

  window._lastGeneratedPlan = { meta: { dest: demo, start, days, budget, traveler, notes, estimate }, plan };
  updateCostDisplay(estimate);
}

generateBtn.addEventListener('click', generateItinerary);

/* render plan HTML */
function renderPlan(plan, estimate){
  itineraryArea.innerHTML = `<h4>Estimated cost: USD ${estimate.toFixed(0)}</h4>` + plan.map(d => `<div class="it-day"><strong>Day ${d.day} — ${d.date}</strong><ul>${d.items.map(i => `<li><em>${i.time}</em>: ${i.activity}</li>`).join('')}</ul></div>`).join('');
}

/* ---------------------------
   Currency conversion (exchangerate.host)
   - caches rates in localStorage for 24 hours
   - auto-detect user's currency via Intl (fallback to USD)
   --------------------------- */
const RATES_KEY = 'hg_rates_v1';
async function fetchRates(){
  const cachedRaw = localStorage.getItem(RATES_KEY);
  if(cachedRaw){
    try{
      const parsed = JSON.parse(cachedRaw);
      const age = Date.now() - parsed.t;
      if(age < 24 * 3600 * 1000 && parsed.rates){ // cached under 24h
        return parsed;
      }
    } catch(e){}
  }
  // fetch fresh
  try{
    const r = await fetch('https://api.exchangerate.host/latest?base=USD');
    const j = await r.json();
    if(j && j.rates){
      const store = { t: Date.now(), rates: j.rates };
      localStorage.setItem(RATES_KEY, JSON.stringify(store));
      return store;
    }
  } catch(e){ console.warn('Failed to fetch rates', e); }
  // fallback to cached if any
  try{ return JSON.parse(cachedRaw); } catch(e){ return null; }
}

async function initCurrency(){
  const ratesStore = await fetchRates();
  const rates = ratesStore && ratesStore.rates ? ratesStore.rates : { USD:1 };
  // build select list (show popular currencies first)
  const popular = ['USD','EUR','GBP','AUD','CAD','JPY','INR','CNY'];
  currencySelect.innerHTML = '';
  // add popular first
  const added = new Set();
  popular.forEach(code => { if(rates[code]){ const opt = document.createElement('option'); opt.value = rates[code]; opt.textContent = code; currencySelect.appendChild(opt); added.add(code); }});
  // then add remaining
  Object.keys(rates).sort().forEach(code => { if(added.has(code)) return; const opt = document.createElement('option'); opt.value = rates[code]; opt.textContent = code; currencySelect.appendChild(opt); });
  // detect user's currency via Intl
  let userCurrency = 'USD';
  try{
    userCurrency = (Intl.DateTimeFormat().resolvedOptions().locale || 'en-US').split('-')[1] || userCurrency;
    // Better fallback: use navigator.language to map to currency? For simplicity, stick to USD fallback
  }catch(e){}
  // If the detected 'country' maps to a currency code in rates, select it
  if(rates[userCurrency]) {
    currencySelect.value = rates[userCurrency];
  } else {
    // try to get currency from navigator.language country
    const locale = navigator.language || navigator.userLanguage || 'en-US';
    const country = locale.split('-')[1];
    if(country){
      // naive mapping for some common countries:
      const mapping = { US:'USD', GB:'GBP', DE:'EUR', FR:'EUR', JP:'JPY', IN:'INR', CN:'CNY', AU:'AUD', CA:'CAD' };
      const cc = mapping[country];
      if(cc && rates[cc]) currencySelect.value = rates[cc];
      else currencySelect.selectedIndex = 0;
    } else currencySelect.selectedIndex = 0;
  }
  currencySelect.addEventListener('change', convertCurrency);
  // if cost present, convert now
  const estimateText = window._lastGeneratedPlan?.meta?.estimate || null;
  if(estimateText) updateCostDisplay(estimateText);
}

/* update cost display and conversion */
function updateCostDisplay(estimate){
  costEstimateEl.innerHTML = `Estimated cost: <strong>USD ${estimate.toFixed(0)}</strong>`;
  convertCurrency();
}

function convertCurrency(){
  const estimate = window._lastGeneratedPlan?.meta?.estimate || (() => {
    // read displayed USD value if present
    const txt = costEstimateEl.textContent || '';
    const found = txt.match(/\$?\s*([0-9,\.]+)/);
    return found ? parseFloat(found[1].replace(/,/g,'')) : 0;
  })();
  const rate = parseFloat(currencySelect.value) || 1;
  const code = currencySelect.selectedOptions[0]?.textContent || 'USD';
  if(isFinite(estimate) && isFinite(rate)){
    const converted = (estimate * rate).toFixed(2);
    convertedCostEl.textContent = `≈ ${converted} ${code}`;
  } else {
    convertedCostEl.textContent = '';
  }
}

/* ---------------------------
   Weather (Open-Meteo)
   - current weather + 3-day daily temps
   --------------------------- */
async function fetchWeather(lat, lon){
  weatherBox.setAttribute('aria-hidden','false');
  weatherBox.innerHTML = '<div class="small">Loading weather…</div>';
  try{
    // current weather and daily (3-day) forecast
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&daily=temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=3`;
    const r = await fetch(url);
    const j = await r.json();
    if(j && j.current_weather){
      const cur = j.current_weather;
      let html = `<div><strong>Now:</strong> ${cur.temperature}°C — <span class="muted">${cur.weathercode ?? ''}</span> (winds ${cur.windspeed} km/h)</div>`;
      if(j.daily && j.daily.time){
        html += `<div class="forecast">`;
        for(let i=0;i<j.daily.time.length;i++){
          const day = j.daily.time[i];
          const tmax = j.daily.temperature_2m_max[i];
          const tmin = j.daily.temperature_2m_min[i];
          html += `<div class="day"><div style="font-weight:600">${day}</div><div>${tmin}° / ${tmax}°</div></div>`;
        }
        html += `</div>`;
      }
      weatherBox.innerHTML = html;
    } else {
      weatherBox.innerHTML = `<div class="small">Weather unavailable</div>`;
    }
  } catch(e){ console.warn('Weather fetch failed', e); weatherBox.innerHTML = `<div class="small">Weather unavailable</div>`; }
}

/* ---------------------------
   Save plan / share / PDF
   --------------------------- */
savePlanBtn.addEventListener('click', ()=>{
  const data = window._lastGeneratedPlan;
  if(!data){ alert('No plan to save'); return; }
  const saved = JSON.parse(localStorage.getItem('hg_saved_plans') || '[]');
  saved.push({ id: Date.now(), created: new Date().toISOString(), data });
  localStorage.setItem('hg_saved_plans', JSON.stringify(saved));
  alert('Plan saved.');
});

sharePlanBtn.addEventListener('click', async ()=>{
  const p = window._lastGeneratedPlan;
  if(!p){ alert('No plan generated'); return; }
  const str = JSON.stringify(p);
  const b64 = btoa(unescape(encodeURIComponent(str))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');
  const url = `${location.origin}${location.pathname}?plan=${b64}`;
  if(navigator.share){
    try{ await navigator.share({ title: `${p.meta.dest.name} trip`, text: `My trip plan`, url }); return; } catch(e){}
  }
  try{ await navigator.clipboard.writeText(url); alert('Share link copied to clipboard'); } catch(e){ prompt('Copy link', url); }
});

downloadPdfBtn.addEventListener('click', async ()=>{
  const last = window._lastGeneratedPlan;
  if(!last){ alert('No plan'); return; }
  if(!jsPDFLoaded){
    try{ await loadScript('https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js'); jsPDFLoaded = true; }catch(e){ alert('Failed to load PDF library'); return; }
  }
  const doc = new jspdf.jsPDF({ unit:'pt', format:'a4' });
  const title = `${last.meta.dest.name} — ${last.meta.start} (${last.meta.days} days)`;
  doc.setFontSize(14); doc.text(title, 40, 50);
  doc.setFontSize(10); doc.text(`Estimated cost: USD ${last.meta.estimate.toFixed(0)}`, 40, 70);
  let y = 100;
  last.plan.forEach(day => {
    doc.setFontSize(11); doc.text(`Day ${day.day} — ${day.date}`, 40, y); y += 16;
    day.items.forEach(it => { doc.setFontSize(10); doc.text(`${it.time}: ${it.activity}`, 60, y); y += 14; if(y>740){ doc.addPage(); y = 40; } });
    y += 8;
  });
  doc.save(`${last.meta.dest.name.replace(/[^a-z0-9]/gi,'_')}_itinerary.pdf`);
});

/* ---------------------------
   Restore shared plan from ?plan=
   --------------------------- */
function decodePlanFromQuery(){
  const params = new URLSearchParams(location.search);
  const b64 = params.get('plan');
  if(!b64) return null;
  try{
    const padded = b64.replace(/-/g,'+').replace(/_/g,'/');
    const json = decodeURIComponent(escape(atob(padded)));
    return JSON.parse(json);
  } catch(e){ console.warn('Failed to decode plan', e); return null; }
}
async function restoreSharedIfAny(){
  const shared = decodePlanFromQuery();
  if(!shared) return;
  // open modal and render
  planBtn.click();
  // give modal a moment to open
  setTimeout(()=>{
    window._lastGeneratedPlan = shared;
    renderPlan(shared.plan, shared.meta.estimate || shared.estimate || (shared.meta?.estimate ?? 0));
    updateCostDisplay(shared.meta?.estimate || shared.estimate || 0);
    downloadPdfBtn.style.display = 'inline-block';
    savePlanBtn.style.display = 'inline-block';
    sharePlanBtn.style.display = 'inline-block';
    injectJSONLD(shared);
  }, 300);
}
restoreSharedIfAny();

/* ---------------------------
   JSON-LD injection for generated plan (helpful for debugging)
   --------------------------- */
function injectJSONLD(p){
  const existing = document.getElementById('plan-jsonld'); if(existing) existing.remove();
  const ld = {
    "@context":"https://schema.org",
    "@type":"TouristTrip",
    "name": `${p.meta.dest.name} — ${p.meta.start}`,
    "description": p.meta.dest.desc || '',
    "touristType": p.meta.traveler,
    "totalTime": `P${p.meta.days}D`,
    "estimatedCost": { "@type":"MonetaryAmount", "currency":"USD", "value": p.meta.estimate }
  };
  const s = document.createElement('script'); s.type='application/ld+json'; s.id='plan-jsonld'; s.textContent = JSON.stringify(ld, null, 2); document.head.appendChild(s);
}

/* ---------------------------
   Bucket list UI
   --------------------------- */
function openBucketModal(){
  const list = JSON.parse(localStorage.getItem('hg_favs') || '[]');
  const grid = document.getElementById('bucketListGrid'); grid.innerHTML = '';
  if(list.length === 0) grid.innerHTML = '<p class="small">Your bucket list is empty.</p>'; else {
    list.forEach(id => {
      const d = document.createElement('div'); d.style.position='relative';
      d.style.borderRadius='10px'; d.style.overflow='hidden'; d.style.boxShadow='0 4px 10px rgba(0,0,0,0.08)';
      d.innerHTML = `<img src="https://picsum.photos/seed/${id}/200/120" loading="lazy" style="display:block;width:100%;height:90px;object-fit:cover"><button style="position:absolute;top:6px;right:6px;background:rgba(0,0,0,0.6);color:#fff;border:none;border-radius:50%;width:28px;height:28px;cursor:pointer" onclick="removeFromBucket(${id})">×</button>`;
      grid.appendChild(d);
    });
  }
  document.getElementById('bucketModal').classList.add('open');
}
function closeBucketModal(){ document.getElementById('bucketModal').classList.remove('open'); }
function removeFromBucket(id){ let list=JSON.parse(localStorage.getItem('hg_favs')||'[]'); list=list.filter(x=>x!==id); localStorage.setItem('hg_favs', JSON.stringify(list)); openBucketModal(); }
document.getElementById('viewBucketBtn').addEventListener('click', openBucketModal);
document.getElementById('saveDemoBtn').addEventListener('click', ()=>{
  const favs=JSON.parse(localStorage.getItem('hg_favs')||'[]'); if(!favs.includes(demo.id)) favs.push(demo.id); localStorage.setItem('hg_favs', JSON.stringify(favs)); alert('Saved to favorites'); });

/* expose removal for inline onclick */
window.removeFromBucket = removeFromBucket;
window.closeBucketModal = closeBucketModal;

/* ---------------------------
   Small accessibility helpers
   --------------------------- */
document.addEventListener('focusin', (e)=>{
  if(!plannerModal.classList.contains('open')) return;
  const panel = plannerModal.querySelector('.modal-panel');
  if(!panel.contains(e.target)) panel.focus();
});

/* preload PDF library after a few seconds (non-blocking) */
setTimeout(()=>{ loadScript('https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js').then(()=>jsPDFLoaded=true).catch(()=>{}); }, 4000);
</script>
</body>
</html>
