<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Underrated Travel â€” Hidden Gems & Smart Travel Tools</title>
  <meta name="description" content="Discover underrated travel destinations with AI itineraries, live weather, interactive maps, trip planner, bucket list and gamified rewards." />
  <meta name="keywords" content="underrated travel, hidden gems, trip planner, itinerary generator, bucket list, live weather, travel calculator" />

  <!-- Styles (concise, performance-minded) -->
  <style>
    :root{--p:#2a9d8f;--a:#e76f51;--dark:#264653;--muted:#6c757d;--card:#fff}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;line-height:1.45;margin:0;background:#f5f7fb;color:#222}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    header{background:linear-gradient(90deg,var(--p),#21867a);color:white;padding:18px 0;position:sticky;top:0;z-index:999}
    header .brand{display:flex;align-items:center;gap:12px;font-weight:800;font-size:1.25rem}
    header .brand i{font-size:1.6rem}
    nav{margin-left:auto}
    .topbar{display:flex;align-items:center;gap:20px}
    .search{display:flex;gap:8px;max-width:760px;width:100%;margin:14px 0}
    input[type=text],input[type=email],select{padding:12px;border-radius:12px;border:1px solid #e6eef2;background:white;flex:1}
    button{background:var(--a);color:white;border:none;padding:10px 16px;border-radius:10px;cursor:pointer}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px}
    .card{background:var(--card);border-radius:12px;box-shadow:0 8px 20px rgba(16,24,40,0.06);overflow:hidden;display:flex;flex-direction:column}
    .card img{width:100%;height:220px;object-fit:cover}
    .card .body{padding:16px;flex:1;display:flex;flex-direction:column}
    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:auto}
    .btn-ghost{background:transparent;border:1px solid #eee;padding:8px 12px;border-radius:8px}
    .map{height:420px;border-radius:12px;overflow:hidden}
    .panel{background:white;padding:16px;border-radius:12px;box-shadow:0 8px 20px rgba(16,24,40,0.04)}
    .flex{display:flex;gap:12px;align-items:center}
    footer{padding:30px;text-align:center;color:#6b7280}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#f1f5f9;color:#0f172a;font-weight:600}
    .floating-chat{position:fixed;right:20px;bottom:20px;background:#0f172a;color:white;border-radius:999px;padding:12px 16px;box-shadow:0 8px 30px rgba(2,6,23,0.2);cursor:pointer;z-index:10000}
    .hidden{display:none}
    .itinerary{white-space:pre-wrap;font-family:inherit}
    @media (max-width:700px){.topbar{flex-direction:column;align-items:stretch}}
  </style>

  <!-- Icons & Leaflet CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" crossorigin="anonymous" />
</head>

<body>
  <header>
    <div class="container topbar">
      <div class="brand"><i>ðŸ§­</i>Underrated<span style="color:#fff;opacity:0.9">Travel</span></div>
      <div style="flex:1"></div>
      <div class="flex" style="gap:8px">
        <input type="text" id="globalSearch" placeholder="Search destinations, experiences, food..." aria-label="Search" style="max-width:420px" oninput="liveSuggest(this.value)">
        <button onclick="openPlanner()">Plan Trip</button>
        <button class="btn-ghost" onclick="openMap()">Full Map</button>
        <div class="badge" id="pointsBadge">Points: 0</div>
      </div>
    </div>
  </header>

  <main class="container" id="app">
    <!-- Hero + Suggested -->
    <section style="display:grid;grid-template-columns:1fr 360px;gap:20px;margin-top:20px">
      <div>
        <h1 style="margin:0 0 8px">Discover Hidden Gems & Build Your Dream Trip</h1>
        <p style="margin:0 0 12px;color:#4b5563">AI itineraries, live weather, personalized bucket list, gamified badges and practical cost estimates â€” all in one place.</p>

        <!-- Smart Filters -->
        <div class="flex" style="margin-bottom:12px">
          <select id="regionF" onchange="applyFilters()">
            <option value="">All Regions</option>
            <option>Europe</option><option>Asia</option><option>Americas</option><option>Africa</option><option>Oceania</option>
          </select>
          <select id="typeF" onchange="applyFilters()">
            <option value="">Any</option><option>Nature</option><option>Culture</option><option>Adventure</option><option>Beach</option>
          </select>
          <select id="budgetF" onchange="applyFilters()">
            <option value="">Any Budget</option><option value="budget">Budget</option><option value="mid">Mid-range</option><option value="luxury">Luxury</option>
          </select>
          <button class="btn-ghost" onclick="resetFilters()">Reset</button>
        </div>

        <!-- Destinations Grid -->
        <div id="destGrid" class="grid"></div>

      </div>

      <!-- Right column: Planner + Live Widgets -->
      <aside style="display:flex;flex-direction:column;gap:16px">
        <div class="panel">
          <h3 style="margin:0 0 8px">Trip Planner (AI-powered)</h3>
          <p style="margin:0 0 12px;color:#475569">Tell our AI your dates, interests and budget. Get a full editable day-by-day plan.</p>
          <div style="display:grid;gap:8px">
            <input type="text" id="tp_dest" placeholder="Destination (city or country)">
            <input type="date" id="tp_start">
            <input type="date" id="tp_end">
            <select id="tp_budget"><option value="budget">Budget</option><option value="mid">Mid-range</option><option value="luxury">Luxury</option></select>
            <select id="tp_style"><option>Nature</option><option>Culture</option><option>Adventure</option><option>Relax</option></select>
            <button onclick="generateItinerary()">Generate Itinerary</button>
          </div>
          <div id="itineraryResult" style="margin-top:12px;color:#0f172a"></div>
        </div>

        <div class="panel">
          <h4 style="margin:0 0 8px">Live Weather & Local Info</h4>
          <div class="flex" style="justify-content:space-between;align-items:center">
            <input type="text" id="weatherLookup" placeholder="Enter city (e.g., Reykjavik)" style="flex:1;margin-right:8px">
            <button onclick="fetchWeather()">Check</button>
          </div>
          <div id="weatherCard" style="margin-top:10px;color:#0f172a"></div>
        </div>

        <div class="panel">
          <h4 style="margin:0 0 8px">My Bucket List</h4>
          <div id="bucketList" style="min-height:70px"></div>
          <div style="margin-top:8px;display:flex;gap:8px"><input id="addBucket" placeholder="Add a place"><button onclick="addToBucket()">Save</button></div>
        </div>

      </aside>
    </section>

    <!-- Map + Heatmap -->
    <section style="margin-top:20px">
      <h2 style="margin:0 0 8px">Interactive Map</h2>
      <div id="map" class="map"></div>
      <p style="color:#475569;margin-top:8px">Click pins to view quick tips, save to bucket list, view live weather, and generate custom itineraries for that place.</p>
    </section>

    <!-- Tools row -->
    <section style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:20px">
      <div class="panel">
        <h4>Travel Cost Calculator</h4>
        <p style="margin:0 0 8px;color:#475569">Estimate trip cost quickly.</p>
        <div style="display:grid;gap:8px">
          <input id="cc_dest" placeholder="Destination">
          <input type="number" id="cc_days" placeholder="Days" value="5">
          <select id="cc_level"><option value="budget">Budget</option><option value="mid">Mid</option><option value="luxury">Luxury</option></select>
          <button onclick="estimateCost()">Estimate</button>
          <div id="cc_result" style="margin-top:8px;font-weight:700"></div>
        </div>
      </div>

      <div class="panel">
        <h4>Quizzes & Fun</h4>
        <p style="margin:0 0 8px;color:#475569">Keep sessions longer with personality quizzes.</p>
        <button onclick="startQuiz()">Which hidden gem fits you?</button>
        <div id="quizArea" style="margin-top:10px"></div>
      </div>

      <div class="panel">
        <h4>Trending & Social Feed</h4>
        <p style="margin:0 0 8px;color:#475569">Live trending gems (based on visits) and curated IG posts.</p>
        <div id="trendingList"></div>
      </div>
    </section>

    <!-- UGC Reviews + FAQs -->
    <section style="margin-top:20px;display:grid;grid-template-columns:2fr 1fr;gap:20px">
      <div>
        <div class="panel">
          <h3>Traveler Reviews (User Generated)</h3>
          <div id="reviews"></div>
          <div style="display:flex;gap:8px;margin-top:12px">
            <input id="rv_name" placeholder="Your name">
            <input id="rv_place" placeholder="Place you visited">
            <button onclick="submitReview()">Submit</button>
          </div>
          <textarea id="rv_text" placeholder="Share one tip" style="width:100%;margin-top:8px;padding:8px;border-radius:8px"></textarea>
        </div>
      </div>
      <div>
        <div class="panel">
          <h3>FAQs & Rich Snippets</h3>
          <details><summary>How do I save a place?</summary><p>Add to bucket list from card or map â€” it syncs to your browser and to your account when connected.</p></details>
          <details><summary>Is weather live?</summary><p>Yes â€” powered by wttr.in and Open-Meteo for more advanced server integrations.</p></details>
        </div>

        <div class="panel" style="margin-top:12px">
          <h3>Badges & Rewards</h3>
          <div id="badgesArea">No badges yet â€” explore and earn!</div>
        </div>
      </div>
    </section>

  </main>

  <div class="floating-chat" onclick="toggleChat()">Chat with Travel AI</div>

  <footer>
    Â© 2025 Underrated Travel â€” Built with AI Precision â€¢ Images: Unsplash â€¢ Map: OpenStreetMap
  </footer>

  <!-- Scripts (no external AI required; hooks included for server/OpenAI integration) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
  <script>
    /*************************************************************************
     * Data - sample destinations (in production this should be dynamic/API)
     *************************************************************************/
    const DESTS = [
      {id:1,name:'Faroe Islands',region:'Europe',type:'Nature',budget:'mid',lat:62.0,lon:-6.8,thumb:'https://images.unsplash.com/photo-1544551763-46a013bb70d5?w=1200&q=60'},
      {id:2,name:'Musandam, Oman',region:'Asia',type:'Nature',budget:'mid',lat:25.8,lon:56.4,thumb:'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=1200&q=60'},
      {id:3,name:'Azores, Portugal',region:'Europe',type:'Nature',budget:'mid',lat:37.7,lon:-25.4,thumb:'https://images.unsplash.com/photo-1552465011-b4e21bf6e79a?w=1200&q=60'},
      {id:4,name:'Ha Giang Loop',region:'Asia',type:'Adventure',budget:'budget',lat:22.7,lon:104.98,thumb:'https://images.unsplash.com/photo-1565075791519-7c6e5f4a5f9f?w=1200&q=60'},
      {id:5,name:'Bhutan',region:'Asia',type:'Culture',budget:'luxury',lat:27.5,lon:90.5,thumb:'https://images.unsplash.com/photo-1526481280698-9d3f5f7d3b6a?w=1200&q=60'}
    ];

    /*************************************************************************
     * Lightweight utilities
     *************************************************************************/
    const $ = sel => document.querySelector(sel);
    const make = (tag,attrs={},...children)=>{const el=document.createElement(tag);Object.entries(attrs).forEach(([k,v])=>el.setAttribute(k,v));children.flat().forEach(c=>typeof c==='string'?el.appendChild(document.createTextNode(c)):el.appendChild(c));return el}

    /*************************************************************************
     * Render destination cards
     *************************************************************************/
    function renderGrid(list=DESTS){
      const grid = $('#destGrid');grid.innerHTML='';
      list.forEach(d=>{
        const card = make('div',{class:'card','data-id':d.id});
        const img = make('img',{src:d.thumb,loading:'lazy',alt:d.name});
        const body = make('div',{class:'body'});
        const h = make('h3',{},d.name);
        const p = make('p',{},`${d.type} â€¢ ${d.region}`);
        const meta = make('div',{class:'meta'});
        const left = make('div',{},make('span',{},`From: ${d.budget==='budget'?'$650':d.budget==='mid'?'$950':'$1800'}`));
        const actions = make('div',{});
        const saveBtn = make('button',{class:'btn-ghost',onclick:`toggleSave(${d.id})`},'Save');
        const itinBtn = make('button',{},'Itinerary');itinBtn.onclick=()=>{prefillPlanner(d.name);generateItinerary();}
        const mapBtn = make('button',{class:'btn-ghost'},'View');mapBtn.onclick=()=>{focusMap(d.lat,d.lon,d.id)}
        actions.appendChild(saveBtn);actions.appendChild(itinBtn);actions.appendChild(mapBtn);
        card.appendChild(img);body.appendChild(h);body.appendChild(p);meta.appendChild(left);meta.appendChild(actions);body.appendChild(meta);card.appendChild(body);
        grid.appendChild(card);
      });
    }

    renderGrid();

    /*************************************************************************
     * Filters & search
     *************************************************************************/
    function applyFilters(){
      const region = $('#regionF').value; const type = $('#typeF').value; const budget = $('#budgetF').value; const q = ($('#globalSearch').value||'').toLowerCase();
      let filtered = DESTS.filter(d=> (region?d.region===region:true) && (type?d.type===type:true) && (budget?d.budget===budget:true) && (!q||d.name.toLowerCase().includes(q)||d.type.toLowerCase().includes(q)) );
      renderGrid(filtered);
    }
    function resetFilters(){ $('#regionF').value='';$('#typeF').value='';$('#budgetF').value='';$('#globalSearch').value='';renderGrid(); }
    function liveSuggest(val){ applyFilters(); }

    /*************************************************************************
     * Bucket list (localStorage) + badges
     *************************************************************************/
    function loadBucket(){ return JSON.parse(localStorage.getItem('bucket')||'[]'); }
    function saveBucket(arr){ localStorage.setItem('bucket',JSON.stringify(arr)); renderBucket(); updatePoints(); }
    function addToBucket(){ const v = $('#addBucket').value.trim(); if(!v) return alert('Enter a place'); const arr=loadBucket(); arr.push({name:v,added:Date.now()}); saveBucket(arr); $('#addBucket').value=''; }
    function toggleSave(id){ const dest = DESTS.find(d=>d.id==id); if(!dest) return; const arr=loadBucket(); if(arr.find(x=>x.name===dest.name)){ const newa=arr.filter(x=>x.name!==dest.name); saveBucket(newa); } else { arr.push({name:dest.name,added:Date.now()}); saveBucket(arr);} }
    function renderBucket(){ const arr=loadBucket(); const el = $('#bucketList'); el.innerHTML=''; if(arr.length===0) el.innerHTML='<em>No saved places yet</em>'; arr.forEach((b,i)=>{ const row = document.createElement('div'); row.style.display='flex';row.style.justifyContent='space-between';row.style.alignItems='center'; row.style.padding='6px 0'; row.innerHTML=`<div>${b.name}</div>`; const rm = document.createElement('button'); rm.textContent='Remove'; rm.onclick=()=>{ const a=loadBucket(); a.splice(i,1); saveBucket(a); }; row.appendChild(rm); el.appendChild(row); }); renderBadges(); }

    function updatePoints(){ const pts = Math.min(999, loadBucket().length*10 + (JSON.parse(localStorage.getItem('visits')||'0')) ); $('#pointsBadge').textContent = `Points: ${pts}`; localStorage.setItem('points',pts); }

    function renderBadges(){ const el = $('#badgesArea'); const arr=loadBucket(); const badges = [];
      if(arr.length>=1) badges.push('Explorer'); if(arr.length>=5) badges.push('Globetrotter'); if((JSON.parse(localStorage.getItem('visits')||'0'))>10) badges.push('Frequent Planner');
      if(badges.length===0) el.textContent='No badges yet â€” save 1 place to earn your first badge.'; else el.innerHTML = badges.map(b=>`<div class='badge' style='margin:6px'>${b}</div>`).join('');
    }

    // init
    renderBucket(); updatePoints(); renderBadges();

    /*************************************************************************
     * Map (Leaflet) with pins and interactions
     *************************************************************************/
    const map = L.map('map',{zoomControl:false}).setView([20,0],2);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'Â© OpenStreetMap'}).addTo(map);
    const markers = {};
    DESTS.forEach(d=>{
      const m = L.marker([d.lat,d.lon]).addTo(map).bindPopup(`<b>${d.name}</b><br>${d.type} â€¢ ${d.region}<br><button onclick="saveFromMap(${d.id})">Save</button> <button onclick="prefillPlanner('${d.name}')">Plan</button>`);
      markers[d.id]=m;
    });
    function saveFromMap(id){ toggleSave(id); map.closePopup(); }
    function focusMap(lat,lon,id){ map.setView([lat,lon],8); if(id && markers[id]) markers[id].openPopup(); }

    function openMap(){ window.scrollTo({top: document.getElementById('map').offsetTop-80, behavior:'smooth'}); }

    /*************************************************************************
     * Itinerary generator â€” client-side 'AI' template with hooks for real AI
     *************************************************************************/
    function daysBetween(a,b){ const A=new Date(a),B=new Date(b); return Math.max(1,Math.round((B-A)/(1000*60*60*24)) + 1); }
    function generateItinerary(){ const dest=$('#tp_dest').value||'a chosen destination'; const start=$('#tp_start').value; const end=$('#tp_end').value; const style=$('#tp_style').value||'Nature'; const budget=$('#tp_budget').value;
      if(!start||!end) return alert('Please select start and end dates'); const days = daysBetween(start,end);
      // Simple deterministic itinerary generator â€” replace with server OpenAI for richer plans
      let out = `Itinerary for ${dest} â€” ${start} to ${end} (${days} days)

`;
      for(let i=1;i<=days;i++){
        out += `Day ${i}: `;
        if(style==='Nature'){ out += i===1?`Arrival & easy walk to viewpoint.`: (i%3===0?`Full-day hike / nature reserve visit.`:`Coastal/mountain exploration and local picnic.`); }
        else if(style==='Culture'){ out += i===1?`Arrival & local market stroll.`: (i%2===0?`Museum / heritage site visits.`:`Cooking class & cultural show.`); }
        else if(style==='Adventure'){ out += i===1?`Arrival & gear check.`: (i%2===0?`Multi-hour trek or water activity.`:`Half-day excursion + local village visit.`); }
        else { out += `Relaxed exploration, cafes and photo stops.` }
        out += `
`;
      }
      out += `
Estimated daily budget: ${budget==='budget'? '$50-$80': budget==='mid'? '$90-$180': '$200+'}`;
      $('#itineraryResult').innerHTML = `<div class='itinerary'>${out}</div><div style='margin-top:8px'><button onclick="saveItinerary()">Save Itinerary</button> <button onclick="shareItinerary()">Share</button></div>`;
      // award points
      const visits = Number(localStorage.getItem('visits')||0)+1; localStorage.setItem('visits',visits); updatePoints(); renderBadges();
    }
    function prefillPlanner(name){ $('#tp_dest').value = name; window.scrollTo({top:document.querySelector('#tp_dest').getBoundingClientRect().top + window.scrollY - 80, behavior:'smooth'}); }
    function saveItinerary(){ const it = $('#itineraryResult').innerText; const stored = JSON.parse(localStorage.getItem('itins')||'[]'); stored.push({id:Date.now(),text:it}); localStorage.setItem('itins',JSON.stringify(stored)); alert('Itinerary saved to your browser. Connect account to sync.'); }
    function shareItinerary(){ alert('Share link generated (placeholder). Integrate server route to persist and share publicly.'); }

    /*************************************************************************
     * Live weather via wttr.in (no key) â€” graceful fallback
     *************************************************************************/
    async function fetchWeather(){ const q = $('#weatherLookup').value.trim(); if(!q) return alert('Enter a city'); $('#weatherCard').textContent='Fetching...';
      try{ const res = await fetch(`https://wttr.in/${encodeURIComponent(q)}?format=j1`); if(!res.ok) throw new Error('no'); const data = await res.json(); const cur = data.current_condition[0]; const out = `${q}: ${cur.temp_C}Â°C, ${cur.weatherDesc[0].value}. Feels like ${cur.FeelsLikeC}Â°C.`; $('#weatherCard').textContent = out; }catch(e){ $('#weatherCard').textContent = 'Weather unavailable. Try another place.' }
    }

    function getWeatherFor(dest){ $('#weatherLookup').value = dest; fetchWeather(); }

    /*************************************************************************
     * Cost calculator
     *************************************************************************/
    function estimateCost(){ const dest = $('#cc_dest').value||'destination'; const days = Number($('#cc_days').value||1); const level = $('#cc_level').value; const base = level==='budget'?70:level==='mid'?140:300; const total = Math.round(base*days + (Math.random()*200)); $('#cc_result').textContent = `Estimated trip cost to ${dest}: ~$${total}`; }

    /*************************************************************************
     * Quiz â€” simple choose flow
     *************************************************************************/
    function startQuiz(){ const qArea = $('#quizArea'); qArea.innerHTML = `<div>Which activity do you prefer?<br><button onclick="finishQuiz('hike')">Hiking</button> <button onclick="finishQuiz('muse')">Museums</button> <button onclick="finishQuiz('sea')">Beaches</button></div>`; }
    function finishQuiz(ans){ const map = {hike:'Azores, Portugal',muse:'Bhutan',sea:'Musandam, Oman'}; $('#quizArea').innerHTML = `We recommend: <strong>${map[ans]}</strong> â€” <button onclick="prefillPlanner('${map[ans]}')">Plan Now</button>` }

    /*************************************************************************
     * Trending & reviews (UGC) â€” stored locally for demo
     *************************************************************************/
    function loadTrending(){ const list = DESTS.slice(0,4).map(d=>`<div style='padding:8px 0;border-bottom:1px solid #f1f5f9'><strong>${d.name}</strong><div style='color:#6b7280'>${d.region} â€¢ ${d.type}</div></div>`).join(''); $('#trendingList').innerHTML = list; }
    function submitReview(){ const name=$('#rv_name').value||'Anonymous'; const place=$('#rv_place').value||'Unknown'; const text=$('#rv_text').value||''; if(!text) return alert('Write something'); const arr = JSON.parse(localStorage.getItem('reviews')||'[]'); arr.unshift({name,place,text,date:Date.now()}); localStorage.setItem('reviews',JSON.stringify(arr)); renderReviews(); $('#rv_text').value=''; }
    function renderReviews(){ const arr = JSON.parse(localStorage.getItem('reviews')||'[]'); $('#reviews').innerHTML = arr.map(r=>`<div style='padding:10px 0;border-bottom:1px solid #f1f5f9'><strong>${r.name}</strong> <em style='color:#6b7280'>(${r.place})</em><div style='margin-top:6px'>${r.text}</div></div>`).join('') || '<em>No reviews yet, be the first!</em>'; }

    loadTrending(); renderReviews();

    /*************************************************************************
     * Simple chatbot concierge â€” rule-based with hooks for server AI
     *************************************************************************/
    let chatOpen = false;
    function toggleChat(){ if(!chatOpen){ openChatWindow(); } else { closeChatWindow(); } }
    function openChatWindow(){ chatOpen=true; const div = document.createElement('div'); div.id='chatWin'; div.style.position='fixed'; div.style.right='20px'; div.style.bottom='80px'; div.style.width='320px'; div.style.maxWidth='calc(100% - 40px)'; div.style.borderRadius='12px'; div.style.boxShadow='0 20px 50px rgba(2,6,23,0.3)'; div.style.overflow='hidden'; div.style.zIndex=10001; div.innerHTML=`<div style='background:#1f2937;color:white;padding:12px;font-weight:700'>Travel Concierge</div><div id='chatLog' style='background:white;color:#0f172a;padding:12px;height:240px;overflow:auto'></div><div style='display:flex;padding:10px;background:#f8fafc'><input id='chatIn' placeholder='Ask about visas, weather, tips...' style='flex:1;padding:8px;border-radius:8px;border:1px solid #e6eef2'><button onclick='sendChat()' style='margin-left:8px'>Send</button></div>`; document.body.appendChild(div); }
    function closeChatWindow(){ chatOpen=false; const el = $('#chatWin'); if(el) el.remove(); }
    function sendChat(){ const v = $('#chatIn').value.trim(); if(!v) return; const log = $('#chatLog'); const userHtml = `<div style='text-align:right'><div style='display:inline-block;background:#eef2ff;padding:8px;border-radius:8px;margin:6px 0'>${v}</div></div>`; log.innerHTML += userHtml; $('#chatIn').value=''; log.scrollTop = log.scrollHeight; // simple rule-based answers:
      setTimeout(()=>{ let ans='I can help with planning, weather lookup, and tips. Try: "best time to visit Faroe Islands" or "budget for 7 days in Azores"';
        const q = v.toLowerCase(); if(q.includes('best time')) ans = 'Generally spring and autumn (Apr-Jun, Sep-Oct) offer mild weather and fewer crowds for many hidden gems.'; else if(q.includes('visa')) ans = 'Visa rules depend on your nationality â€” check your government site or ask which country and I can summarize common rules.'; else if(q.includes('budget')) ans = 'Budget varies â€” use the Travel Cost Calculator: choose destination and days for a quick estimate.'; else if(q.includes('weather')){ const match = v.match(/in (.+)$/); if(match){ const city = match[1].trim(); getWeatherFor(city); ans = 'Fetching live weather â€” check the widget on the right.' } }
        log.innerHTML += `<div style='text-align:left'><div style='display:inline-block;background:#f1f5f9;padding:8px;border-radius:8px;margin:6px 0'>${ans}</div></div>`; log.scrollTop = log.scrollHeight; },600);
    }

    /*************************************************************************
     * Persistence: save user state to simulate personalization
     *************************************************************************/
    window.addEventListener('load',()=>{ if(!localStorage.getItem('visits')) localStorage.setItem('visits',0); localStorage.setItem('visits', Number(localStorage.getItem('visits'))+1); updatePoints(); renderBucket(); renderBadges(); renderGrid(); })

    /*************************************************************************
     * Tiny helpers exposed for inline HTML from map popups
     *************************************************************************/
    window.toggleSave = toggleSave; window.prefillPlanner = prefillPlanner; window.saveFromMap = saveFromMap; window.focusMap = focusMap; window.getWeatherFor = getWeatherFor;

    /*************************************************************************
     * Accessibility & SEO: JSON-LD schema (places sample)
     *************************************************************************/
    const schema = {
      "@context":"https://schema.org",
      "@graph": DESTS.map(d=>({"@type":"TouristDestination","name":d.name,"description":`${d.name} â€” ${d.type} in ${d.region}`,"geo":{"@type":"GeoCoordinates","latitude":d.lat,"longitude":d.lon}}))
    };
    const s = document.createElement('script'); s.type='application/ld+json'; s.textContent = JSON.stringify(schema); document.head.appendChild(s);

    /*************************************************************************
     * Small UX helpers
     *************************************************************************/
    function openPlanner(){ window.scrollTo({top: document.querySelector('#tp_dest').getBoundingClientRect().top + window.scrollY - 80, behavior:'smooth'}); $('#tp_dest').focus(); }
  </script>
</body>
</html>
